---
phase: 01-drawing-tools
plan: 03
type: execute
wave: 3
depends_on: [01-02]
files_modified: []
autonomous: false
requirements: [DRAW-01, DRAW-02, DRAW-03, DRAW-04, UI-01, HIST-01]

must_haves:
  truths:
    - "User can activate Draw tab and see pencil, line, rect, and circle tool buttons"
    - "User can draw a freehand pencil stroke and see it baked into the image on mouseup"
    - "User can drag to draw a rectangle or circle shape on the photo"
    - "User can drag to draw a straight line with an optional arrowhead"
    - "Each stroke or shape is individually undoable and redoable"
  artifacts:
    - path: "src/operations/PencilOperation.ts"
      provides: "Freehand stroke operation"
      exports: ["PencilOperation"]
    - path: "src/operations/LineOperation.ts"
      provides: "Straight line + arrowhead operation"
      exports: ["LineOperation"]
    - path: "src/ui/ShapeDrawer.ts"
      provides: "Unified four-tool drawing controller"
      min_lines: 150
  key_links:
    - from: "ShapeDrawer mouseup handler"
      to: "ImageEditor.applyPencil / applyLine"
      via: "commit on mouseup with full-res scaled coordinates"
      pattern: "applyPencil|applyLine"
---

<objective>
Human verification that all four drawing tools work end-to-end in the browser — freehand pencil, rectangle, circle, and line/arrow — with each action individually undoable.

Purpose: Automated TypeScript compilation only catches type errors. This checkpoint confirms the actual interactive UX: strokes render correctly at full resolution, undo works as expected, and the Draw tab integrates cleanly without breaking other tools.

Output: Confirmed working drawing tools or documented issues for a gap-closure plan.
</objective>

<execution_context>
@/Users/iedo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/iedo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/01-drawing-tools/01-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify all four drawing tools work end-to-end in browser</name>
  <files>none — verification only</files>
  <action>Human verifies interactive drawing tools in browser per the steps below.</action>
  <verify>
    <manual>Run npm run dev and follow the 7-step verification checklist below.</manual>
  </verify>
  <done>All 7 checks pass: four tools functional, undo/redo works individually, no regression in other tabs.</done>
  <what-built>
    Four drawing tools wired end-to-end: pencil (freehand), rectangle, circle, and line with optional arrowhead. Each tool is accessible from the Draw tab panel. Each committed stroke/shape is individually undoable via Ctrl+Z / Cmd+Z.
  </what-built>
  <how-to-verify>
    Run `npm run dev` from the project root, then open http://localhost:5173 in a browser.

    Load a photo (or paste one). Then verify each item:

    1. **Draw tab visible**: Click the "Draw" category tab — confirm you see pencil button, line button, Arrow checkbox, rect button, and circle button in the panel.

    2. **Pencil tool** (or press P):
       - Click the pencil button to activate it
       - Draw a freehand squiggle on the photo by clicking and dragging
       - Release mouse — the stroke should be baked into the image (not floating)
       - Verify the cursor is crosshair while pencil is active

    3. **Rectangle tool**:
       - Click the rect button
       - Drag to draw a rectangle — confirm it commits on mouseup (or via Apply if that's the existing flow)

    4. **Circle tool**:
       - Click the circle button
       - Drag to draw a circle/ellipse — confirm it commits correctly

    5. **Line tool** (or press L):
       - Click the line button
       - Drag across the photo — confirm a live preview line appears during drag
       - Release mouse — line is baked in
       - Check the Arrow checkbox, draw another line — arrowhead should appear at the endpoint

    6. **Undo/Redo**:
       - Draw two separate strokes/shapes
       - Press Ctrl+Z (Cmd+Z on Mac) twice — each undoes one stroke individually (not both at once)
       - Press Ctrl+Y (or Ctrl+Shift+Z) — redoes one stroke

    7. **No regression on other tabs**: Switch to Adjust tab, move brightness slider — confirm it still works. Switch to Crop tab — confirm crop selector still activates.

    Report any visual glitches, incorrect positions, missing features, or regressions.
  </how-to-verify>
  <resume-signal>Type "approved" if all 7 checks pass. Otherwise describe which check failed and what you observed.</resume-signal>
</task>

</tasks>

<verification>
Human verification of interactive drawing UX. All seven checks must pass for phase completion.
</verification>

<success_criteria>
- All four drawing tools activate from Draw tab and commit strokes/shapes to the image
- Each drawing action is individually undoable
- No regression in other tool panels (Adjust, Crop, etc.)
- Arrowhead renders at the correct end of the line when Arrow checkbox is checked
</success_criteria>

<output>
After approval, create `.planning/phases/01-drawing-tools/01-03-SUMMARY.md` using the summary template. Then update .planning/STATE.md: set Phase 1 status to complete, update progress to 100% for this phase.
</output>
